分步说明
要将Ubuntu服务器配置为代理服务器，并通过Python脚本使用该代理进行HTTP请求，请按照以下步骤操作：
步骤一：安装和配置Squid代理服务器


更新软件包列表
sudo apt update



安装Squid
sudo apt install squid



编辑Squid配置文件
使用文本编辑器（如nano）打开配置文件：
sudo nano /etc/squid/squid.conf

添加或修改以下内容以允许所有IP地址访问（生产环境建议限制IP范围）：
# 允许来自所有IP的请求
acl localnet src 0.0.0.0/0.0.0.0
http_access allow localnet

# 设置Squid监听的端口，例如3128
http_port 3128



重启Squid服务以应用更改
sudo systemctl restart squid



配置防火墙以允许Squid代理端口
使用ufw允许3128端口的流量：
sudo ufw allow 3128
sudo ufw reload



步骤二：测试代理服务器


使用curl测试代理
在本地机器上运行以下命令，确保代理服务器正常工作：
curl -x http://43.125.62.15:3128 http://ipinfo.io

如果代理服务器正常，curl应返回服务器的IP信息。


步骤三：配置Python脚本使用代理


安装requests库
如果尚未安装，请运行：
pip install requests



编写Python脚本
创建一个Python脚本文件，例如proxy_test.py，并添加以下代码：
import requests

proxies = {
    'http': 'http://43.125.62.15:3128',
    'https': 'http://43.125.62.15:3128'
}

url = 'http://ipinfo.io'
response = requests.get(url, proxies=proxies)
print(response.text)



运行Python脚本
在终端中执行：
python proxy_test.py

如果代理服务器正常工作，脚本应输出服务器的IP信息。


步骤四：故障排除
如果遇到问题，请检查以下方面：


Squid服务状态
sudo systemctl status squid



防火墙配置
sudo ufw status



Squid配置文件
确保配置文件中正确设置了http_port和访问控制列表（ACL）。


代理服务器的IP和端口
确认Python脚本中代理服务器的IP地址和端口与实际配置一致。


步骤五：使用Shadowsocks作为替代方案
如果你更倾向于使用Shadowsocks，可以按照以下步骤进行配置：


安装Shadowsocks
sudo apt update
sudo apt install python3-pip
sudo pip3 install shadowsocks



创建配置文件
sudo nano /etc/shadowsocks.json

添加以下内容（替换密码）：
{
  "server": "0.0.0.0",
  "server_port": 8388,
  "password": "your_secure_password",
  "method": "aes-256-gcm"
}



启动Shadowsocks服务
ssserver -c /etc/shadowsocks.json -d start



配置防火墙
sudo ufw allow 8388
sudo ufw reload



在Python脚本中使用Shadowsocks代理
安装socks和requests库：
pip install requests[socks]

编写Python脚本：
import requests

proxies = {
    'http': 'socks5://43.125.62.15:8388',
    'https': 'socks5://43.125.62.15:8388'
}

url = 'http://ipinfo.io'
response = requests.get(url, proxies=proxies)
print(response.text)



运行脚本
python proxy_test.py



通过以上步骤，你可以成功地将Ubuntu服务器配置为代理服务器，并通过Python脚本使用该代理进行HTTP请求。选择适合你需求的代理方案，并确保安全配置以保护你的服务器和数据。
